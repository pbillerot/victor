<!-- vusers.html -->
{{$session := .Session}}
{{$appid := .AppId}}
{{$portail := .Portail}}
{{$app := .Application}}
{{$theme := .Config.Theme}}
{{$dirid := .DirId}}
{{$baseid := .BaseId}}
{{$composter := .Composter}}
{{$search := .Search}}
{{$records := .Records}}
{{$id := .ID}}
<!DOCTYPE html>
<html>
{{template "_head.html" .}}

<body>
  <!-- NAVBAR -->
  <div class="ui container">
    <div class="ui {{.Config.Theme}} inverted large fixed menu navbar">
      <!-- LEFT MENU -->
      <div class="ui dropdown item">
        <div class="ui mini image">
          <img src="{{$app.Image}}">
        </div>
        <div class="menu">
          <a href="/bee" class="item"><i class="home icon"></i> Page d'accueil</a>
          <!-- end range appViewq-->
          <div class="divider"></div>
          <div class="header">
            <i class="user icon"></i>
            {{.Session.Username}}
          </div>
          <a class="item" href="/bee/edit/admin/users/vall/fprofil/{{.Session.Username}}">Mon profil</a>
          <a class="item" href="/bee/logout">Se déconnecter</a>
          <a href="/bee/about" class="item">À propos</a>
        </div>
      </div>
      <div class="header item" id="crud-header">
        <span class="crud-mobile-hide">
          {{.TabTitle}}
        </span>
      </div>
      <!-- RIGHT MENU -->
      <div class="right menu">
        <div class="item">
          <div class="ui buttons">
            <div class="ui icon {{$theme}} button hugo-window-open" data-url="{{.HugoUrl}}"
              data-posx="left" data-width="1200" data-posy="150" target="hugo-test"
              title="Voir sur le site de test">
              <i class="eye icon"></i>
            </div>
            <div class="ui icon {{$theme}} button hugo-window-open" data-url="{{.HugoUrl}}/site/help/arbo"
              data-posx="left" data-width="1200" data-posy="150" target="hugo-test"
              title="Voir sur le site de test">
              <i class="help icon"></i>
            </div>
          </div>
        </div>
        <div class="ui icon item">
          <i class="search link icon" id="crud-search-active" title="Rechercher..."></i>
          <!-- Recherche -->
          <div style="display: none" id="crud-search">
            <div class="ui icon input">
              <input type="text" id="search" name="search" data-url="" value="{{$search}}" placeholder="Recherche...">
              <i class="circular search link icon" id="crud-search-go" title="Rechercher"></i>
            </div>
            <i class="close link icon" id="crud-search-close" title="Fermer recherche"></i>
          </div>
        </div>
        <!-- end dropdown MENU à droite -->
      </div>
      <!-- end right menu -->
    </div>
  </div>
  <!-- MAIN -->
  <main>
    <div class="ui container">
      {{template "_flash.html" .}}
      <!-- Title on Mobile -->
      <div class="crud-mobile-show ui label">
        {{.TabTitle}}
      </div>
      <div class="ui large divided list">
        <!-- ITEMS -->
        {{ $currentLevel := 0}}
        {{ $color := "yellow"}}
        <!-- BOUCLE Records -->
        {{ range $irecord, $record := .Records }}

        {{ $color = "green"}}
        {{ if $record.Inline}}{{$color = "green"}}{{end}}
        {{ if $record.Planified}}{{$color = "blue"}}{{end}}
        {{ if $record.Expired}}{{$color = "warning"}}{{end}}
        {{ if eq $record.Draft "1"}}{{$color = "error"}}{{end}}

        {{ if lt $record.Level $currentLevel}}
      </div> <!-- /content-->
    </div> <!-- /item-->
    </div> <!-- /list-->
    {{ $currentLevel = HugoDecrement $currentLevel }}
    {{end}}
    {{ if lt $record.Level $currentLevel}}
    </div> <!-- /content-->
    </div> <!-- /item-->
    </div> <!-- /list-->
    {{ $currentLevel = HugoDecrement $currentLevel }}
    {{end}}
    {{ if lt $record.Level $currentLevel}}
    </div> <!-- /content-->
    </div> <!-- /item-->
    </div> <!-- /list-->
    {{ $currentLevel = HugoDecrement $currentLevel }}
    {{ end }}
    {{ if eq $record.IsDir 1 }}
    {{ if eq $record.Level $currentLevel}}
    {{ if gt $currentLevel 0}}
    </div><!-- /content -->
    </div><!-- /item-->
    {{end}}
    <div class="item">
      <!-- REPERTOIRES -->
      <i id="{{$record.Key}}" data-root="{{$record.Root}}" class="folder outline large brown icon link crud-collapse"></i>
      <div class="content">
        <a {{if eq $record.Key $record.Root}}id="{{$record.ID}}" {{else}}id="{{$record.Key}}" {{end}}
          data-root="{{$record.Root}}" class="header hugo-window-open"
          data-url="/bee/hugo/directory/{{$appid}}/{{$record.Key}}" data-posx="right" target="hugo-view">
          {{$record.Base}}</a>
        {{ else if gt $record.Level $currentLevel }}
        {{if gt $record.Level 1}}<div class="list" {{if eq $search ``}} style="display: none;" {{end}}>{{end}}
          <div class="item">
            <i id="{{$record.Key}}" data-root="{{$record.Root}}" class="folder outline large brown icon link crud-collapse"></i>
            <div class="content">
              <a {{if eq $record.Key $record.Root}}id="{{$record.ID}}" {{else}}id="{{$record.Key}}" {{end}}
                data-root="{{$record.Root}}" class="header hugo-window-open"
                data-url="/bee/hugo/directory/{{$appid}}/{{$record.Key}}" data-posx="right"
                target="hugo-view">{{$record.Base}}</a>
              {{ end }}
              {{ else }}
              {{ if or (eq $record.Ext ".png") (eq $record.Ext ".jpg") (eq $record.Ext ".svg")}}
              <!-- IMAGE -->
              <a id="{{$record.Key}}" data-root="{{$record.Root}}" class="ui compact message hugo-window-open"
                {{if eq $search ``}} style="display: none;" {{end}}
                data-url="/bee/hugo/image/{{$appid}}/{{$record.Key}}" data-posx="right" target="hugo-view">
                <i class="image outline blue large icon"></i>
                <span>{{$record.Base}}</span>
              </a>
              {{ else if (eq $record.Ext ".pdf")}}
              <!-- PDF -->
              <a id="{{$record.Key}}" data-root="{{$record.Root}}" class="ui compact message hugo-window-open"
                {{if eq $search ``}} style="display: none;" {{end}} data-url="/bee/hugo/pdf/{{$appid}}/{{$record.Key}}"
                data-posx="right" target="hugo-view">
                <i class="file pdf outline red large icon"></i>{{$record.Base}}</a>
              {{ else if (eq $record.Ext ".yaml")}}
              <!-- YAML -->
              <a id="{{$record.Key}}" data-root="{{$record.Root}}" class="ui compact brown message hugo-window-open"
                {{if eq $search ``}} style="display: none;" {{end}}
                data-url="/bee/hugo/document/{{$appid}}/{{$record.Key}}" data-posx="right" target="hugo-view">
                <i class="file code outline brown large icon"></i>{{$record.Base}}</a>
              {{else}}
              <!-- DOCUMENT -->
              <div id="{{$record.Key}}" data-root="{{$record.Root}}" class="ui {{$color}} compact message "
                {{if eq $search ``}} style="display: none;" {{end}}>
                <i class="file alternate outline green large icon"></i>
                <a class="ui medium text hugo-window-open" data-url="/bee/hugo/document/{{$appid}}/{{$record.Key}}"
                  data-posx="right" target="hugo-view">
                  <b class="searchable">{{$record.Base}}</b>
                </a>
                <span class="ui purple text">[{{$record.Title}}]</span>
                {{$arr := BeeSplit $record.Tags ","}}
                {{range $i, $item := $arr}}
                <div class="ui grey basic label"><b>#{{$item}}</b></div>
                {{end}}
                {{$arr := BeeSplit $record.Categories ","}}
                {{range $i, $item := $arr}}
                <div class="ui tag grey basic label"><b>{{$item}}</b></div>
                {{end}}
                {{if (eq $record.Draft "1") }}
                <span class="ui red text" title="brouillon"><i class="firstdraft icon"></i></span>
                {{end}}
                {{if or $record.DatePublish $record.DateExpiry }}
                <div class="ui yellow image label">
                  <i class="clock outline icon"></i>
                  {{if $record.DatePublish}}<span title="date publication">
                    {{if $record.Planified }}<span class="ui red text">{{$record.DatePublish}}</span>
                    {{else}}{{$record.DatePublish}}{{end}}
                  </span>{{end}}
                  {{if $record.DateExpiry}}
                  <div class="detail" title="date expiration">
                    {{if $record.Expired }}<span class="ui red text">{{$record.DateExpiry}}</span>
                    {{else}}{{$record.DateExpiry}}{{end}}</div>
                  {{end}}
                </div>
                {{end}}
              </div>
              {{end}}
              {{ end }}
              <!-- / isdir-->
              {{ $currentLevel = $record.Level }}
              {{end}}
              <!-- end range $records -->
              {{ if ne $currentLevel 1}}
            </div> <!-- /content-->
          </div> <!-- /item-->
          <!-- / BOUCLE Records -->
        </div> <!-- /list-->
        {{end}}
        {{ $currentLevel = HugoDecrement $currentLevel }}
        {{ if ne $currentLevel 1}}
      </div> <!-- /content-->
    </div> <!-- /item-->
    </div> <!-- /list-->
    {{end }}
    </div> <!-- end container-->
  </main>
  <!-- Demande de confirmation de l'action' -->
  <div id="crud-modal-confirm" class="ui modal">
    <div class="header" id="crud-action">Texte à venir</div>
    <div class="content">
      <p>Veuillez le confirmer</p>
    </div>
    <div class="actions">
      <div class="ui cancel button">Annuler</div>
      <div class="ui approve button">Je confirme</div>
    </div>
  </div> <!-- end modal confirm -->

  <!-- Affichage d'une image en popup-->
  <div id="hugo-modal-image" class="ui modal">
    <div class="actions">
      <div class="ui cancel button">Fermer</div>
    </div>
    <div class="image content">
      <img id="hugo-image" class="ui large image" src="">
    </div>
  </div> <!-- end modal image -->

  <form method="POST" action="/bee/hugo/list/{{$appid}}">
    {{ .xsrfdata }}
    <input type="hidden" id="crud-form-search" name="search">
    <input type="hidden" id="crud-form-searchstop" name="searchstop">
  </form>
  <!-- CONTEXTE -->
  <input type="hidden" id="hugo_view" value="hugo-{{$appid}}">

  {{template "_foot.html" .}}
</body>

</html>